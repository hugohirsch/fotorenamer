<?xml version="1.0" encoding="UTF-8"?>
<pmd-cpd>
<duplication lines="44" tokens="118">
<file line="56" path="/Users/philippottlinger/idea10neu/fotorenamer/src/main/java/de/aikiit/bildbearbeiter/image/AbstractImageRenamer.java"/>
<file line="48" path="/Users/philippottlinger/idea10neu/fotorenamer/src/main/java/de/aikiit/bildbearbeiter/image/DateinamenManipulierer.java"/>
<codefragment>
<![CDATA[
    public DateinamenManipulierer(final String verzeichnis)
            throws InvalidDirectoryException, NoFilesFoundException {
        this.currentDirectory = new File(verzeichnis);

        // erst starten, wenn die Eingabeprüfung erfolgreich war
        validateUserSelectionAndInitInternally();

        new Thread(this).start();
    } // end of Konstruktor

    /**
     * Checks whether the selected directory contains any relevant files and
     * sets internal state appropriately.
     *
     * @throws de.aikiit.bildbearbeiter.exception.NoFilesFoundException
     *          If selected directory contains no files.
     * @throws de.aikiit.bildbearbeiter.exception.InvalidDirectoryException
     *          If any I/O-error occured when accessing the directory.
     */
    protected final void validateUserSelectionAndInitInternally()
            throws NoFilesFoundException, InvalidDirectoryException {
        // Verzeichnis gültig ?
        if (!this.currentDirectory.isDirectory()) {
            throw new InvalidDirectoryException(this.currentDirectory);
        }

        // Dateien da ?
        this.imageList = this.currentDirectory.listFiles(
                new ImageFilenameFilter());
        if (this.imageList == null || this.imageList.length == 0) {
            throw new NoFilesFoundException(this.currentDirectory);
        }

        // internen Zustand setzen
        this.amountOfFiles = this.imageList.length;
    } // end of pruefeEingabe

    /**
     * Performs the actual/technical renaming.
     *
     * @throws RenamingErrorException if any errors occur.
     * @see #validateUserSelectionAndInitInternally()
     */
    public final void rename() throws RenamingErrorException {
]]>
</codefragment>
</duplication>
<duplication lines="16" tokens="115">
<file line="107" path="/Users/philippottlinger/idea10neu/fotorenamer/src/main/java/de/aikiit/bildbearbeiter/image/AbstractImageRenamer.java"/>
<file line="102" path="/Users/philippottlinger/idea10neu/fotorenamer/src/main/java/de/aikiit/bildbearbeiter/image/DateinamenManipulierer.java"/>
<codefragment>
<![CDATA[
            this.progressBar.setProgress(i);
            this.progressBar.setText(this.imageList[i].getName());
            // Da die Namen verschieden lang sind den ProgressBar updaten!
            LOG.info("Renaming " + this.imageList[i].getName() + " to "
                    + targetFilename);
            this.progressBar.updateUI();

            // only renameFiles files
            if (this.imageList[i].isFile() && !this.imageList[i].renameTo(
                            new File(this.imageList[i].getParent(),
                                    targetFilename))) {
                throw new RenamingErrorException("\tFehler bei Bild"
                        + this.imageList[i].getName());
            } // end if - isFile()
        } // end of for
    } // end of renameFiles
]]>
</codefragment>
</duplication>
</pmd-cpd>